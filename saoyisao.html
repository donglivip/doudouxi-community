<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Barcode Example</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<script src="js/rem.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<div class="wrpaper">
			<!--头部-->
			<div class="header">
				<div class="head-tab mui-action-back">
					<img src="img/Arrow_Simple_left Copy@2x.png" class="back" />
				</div>
				<div class="head-main">
					扫一扫
				</div>
				<div class="head-tab">

				</div>
			</div>
			<div class="alert">
				<div class="alert-inner">
					<div class="alert-top">
						豆豆洗
					</div>
					<div class="text">
						错误
					</div>
					<div class="button">
						<div style="border: 0;" id="true">确定</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$(function() {
			var barcode = null;
			$('.alert').hide()
			function alertboo(text) {
				$('.text').html(text)
				if($('.alert').css('display') == 'none') {
					plus.webview.currentWebview().remove(barcode);
					barcode.close()
					$('.alert').css('display', 'flex')
				} else {
					var prePage = plus.webview.currentWebview();
					prePage.reload(true);
					$('.alert').css('display', 'none')
				}
			}
			function create(){
				if(!barcode) {
					barcode = plus.barcode.create('barcode', [plus.barcode.QR], {
						top: '0',
						left: '0px',
						width: '100%',
						height: '100%',
						frameColor: '#096148'
					});
					barcode.onmarked = onmarked;
					plus.webview.currentWebview().append(barcode);
				}
				barcode.start();
			}
			function onmarked(type, result) {
					var text = '未知: ';
					switch(type) {
						case plus.barcode.QR:
							text = 'QR: ';
							break;
						case plus.barcode.EAN13:
							text = 'EAN13: ';
							break;
						case plus.barcode.EAN8:
							text = 'EAN8: ';
							break;
					}
					var myjson = [{
							"lockid": "0",
							"sign": "C3205FABAE74ECF4F41069736C00F75E",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},{
							"lockid": "1",
							"sign": "C065B9970188EFBF9956C9D2E8F27B42",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "2",
							"sign": "A65C1B28791BC1CDF0A8C186D7746532",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "3",
							"sign": "940079EEE3B1D7E9E6C2A4BFC1AFE37C",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "4",
							"sign": "8819DBE69691401BCDC75D4D65244E25",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "5",
							"sign": "77C34754C0D232463F58A8F5EFF1E69A",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "6",
							"sign": "0FB6CE316F3064D583BB58AD281430D3",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "7",
							"sign": "888619AE52723E41888BD8505F429C70",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "8",
							"sign": "C04870BDB7AE6682F32183D8E441215D",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "9",
							"sign": "C0D1E9FF50555E8112D04DB97769CE3A",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "10",
							"sign": "67A8B15871F45B03EF051633C4B4C65C",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "11",
							"sign": "C54B578C8625710B02C90AB62934AAD0",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "12",
							"sign": "563D478BDDD6862D37365FE84977A187",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "13",
							"sign": "259D9ED821B21472D5DCF60B54BE6420",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "14",
							"sign": "1EB2F7E87F2055EBDDC15438A2CE829A",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "15",
							"sign": "6B653B3CC814022D0C86311FC3E3C37C",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "16",
							"sign": "34223446A1AB8EA962789220B0976ECF",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "17",
							"sign": "754C5D9EBA80D737198DC5E6C10B8A67",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "18",
							"sign": "574BC8A5E1BB48383340817ECFD714F3",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "19",
							"sign": "5A2F51B1BE8D0E040B8BD5ECDDB94304",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "20",
							"sign": "3CB5D7C21B0B9B4D0DFAF63180D4FF5A",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "21",
							"sign": "54DDC03ED5A4D96C6D86FB98924351D2",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "22",
							"sign": "78F3400364D5F5313DB6CB6B3C3F1116",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "23",
							"sign": "3D7F2BE99A62F0B97F9A034A18640A70 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "24",
							"sign": "79EB8EA79049C215DD6D72213496278D ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "25",
							"sign": "BBC6EB8C904BB655F34E9063CE0F8C79 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "26",
							"sign": "484911903FA2119EF54BA32BBF0D091F ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "27",
							"sign": "473F0A9C6994E4E40A12E9375A1DBA7D ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "28",
							"sign": "1B0C64F2756C2A94BC8623CC8AFD9D7A ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "29",
							"sign": "5C6B7D90BC3F580162CE557B3B005745 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "30",
							"sign": "8042CD9F5026B3600B327B04C8A890A9 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "31",
							"sign": "CD1C9234EE2F5794B7FAFCEC5BBBE8AF ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "32",
							"sign": "8121484389DEB130BAECB861F0FE8FF1 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "33",
							"sign": "EA5DDAC13B8F1E6B7D8E37E47B89BA8A ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "34",
							"sign": "26ED8EF2F4CC9851C8A007B3FDB4EDDB ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "35",
							"sign": "48527B938F20FB7E8AA0867CB18B4FF5 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "36",
							"sign": "EC8DCD7E298A9F30C2B567C48CDA7E9F ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "37",
							"sign": "9000F7B2B89FB05F6DCE0826A4BE5E9D ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "38",
							"sign": "52A783088DD4484D5A31C3C6E32DB8C6 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "39",
							"sign": "D956996BFDF203C252863D7F19CACBBD ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "40",
							"sign": "D695F846A3B95387B9F1EC535E81BAFF ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "41",
							"sign": "5638F31A9DAE879DA2D298CD0E18AC73 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "42",
							"sign": "F51B44B0D60C3AB3C50A5648147E9E73 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "43",
							"sign": "DF0B6F789F0F8E0A1900E9A0910A031D ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "44",
							"sign": "35BB26C84345575DAFABAD1CABA737DC ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "45",
							"sign": "EE5CEB2D73381F9C98B3E3A3C6868527 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "46",
							"sign": "44ED324695918BB42590C74108E3AEE3 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						},
						{
							"lockid": "46",
							"sign": "12716AC67C55A9899DE8D7C4DEA9C9E5 ",
							"action": "openlock",
							"devicename": "YC58b3fc8e2997"
						}
					]
					var index = Math.floor(Math.random() * 45)
					plus.nativeUI.showWaiting('扫描结果识别中')
					$.ajax({
						type: "get",
						url: "http://192.168.0.241:8080/openlock?devicename=" + myjson[index].devicename + "&lockid=" + (index) + "&sign=" + myjson[index].sign + "",
						dataType: 'json',
						timeout:2000,
						success: function(res) {
							plus.nativeUI.closeWaiting()
							if(res.code == 0) {
								mui.back()
							} else if(res.code == -1) {
								alertboo('柜门打开失败')
							} else {
								alertboo('系统暂时故障，请稍候再试...')
							}

						},
						error: function(err) {
							plus.nativeUI.closeWaiting()
							alertboo('数据获取失败')
							var wvs=plus.webview.all();
							for(var i=0;i<wvs.length;i++){
								if(wvs[i].getURL().indexOf('index')==-1){
									plus.webview.close(wvs[i])
								}
							}
						}
					});
				}
			$('#true').click(function(){
				alertboo('')
			})
			document.addEventListener("plusready", function() {
				create()
			}, false);
		})
	</script>

</html>