<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<script src="js/rem.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
		<title></title>
	</head>

	<body>
		<div class="wrapper order trade">
			<!--头部-->
			<div class="header">
				<div class="head-tab" @click="opennew('index')">
					<img src="img/Arrow_Simple_left Copy@2x.png" class="back" />
				</div>
				<div class="head-main">
					干洗店订单
				</div>
				<div class="head-tab">

				</div>
			</div>
			<!--中间主体-->
			<div class="main big-main complaint">
				<div class="order-main">
					<div class="trade-top">
						<div class="trade-item" :class="myindex==4?'active':''" @click="indexchange(4)">
							<div class="text">待核实</div>
							<div class="radius"></div>
						</div>
						<div class="trade-item" :class="myindex==7?'active':''" @click="indexchange(7)">
							<div class="text">调整中</div>
							<div class="radius"></div>
						</div>
						<div class="trade-item" :class="myindex==8?'active':''" @click="indexchange(8)">
							<div class="text">待完成</div>
							<div class="radius"></div>
						</div>
					</div>
					<div class="trade-main activity">
						<div class="order-box" v-if="myindex==4" v-for="val in mydata" @click="opendetail(val.pbOrderId)">
							<div class="order-right">
								<div class="order-bottom" style="border-bottom: 1px solid #F4F4F4;height: .9rem;">
									<div class="order-price">订单号:{{val.pbOrderId}}</div>
									<a class="order-time" :href="['tel:'+val.usName]" style="font-size: .2rem;color: #096148;">
										联系用户
									</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">清洗最迟时间</div>
									<div class="order-time">{{val.pbOrCleanTimeString}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price">取送员电话</div>
									<a class="order-time" :href="['tel:'+val.usStPhone]">{{val.usStPhone}}</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">订单价格</div>
									<div class="order-time">￥{{val.pbOrCountPrice}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price" style="flex: 1;height: auto;">
										订单内容:
										<bloack v-for='item in val.orderDetaileList'>
											{{item.pbCdName}} x{{item.pbRdNum}}
										</bloack>
									</div>
								</div>
								<div class="order-bottom" style="border-top: 1px solid #F4F4F4;">
									<div class="order-price"></div>
									<div class="order-time setting">
										<a class="btn01" @click="opennew('nav',val.orderDetaileList[0].pbPartnerDeviceId,val.usCommunityPartnerId,val.pbOrderId,val.orderDetaileList,val.usUserId)" href="javascript:void(0)">调整订单</a>
										<a class="btn02"  @click="orderok(val.pbOrderId,val.usUserId)" href="javascript:void(0)">核实订单</a>
									</div>
								</div>
							</div>
						</div>
						<div class="order-box" v-if="myindex==7" v-for="val in mydata" @click="opendetail(val.pbOrderId)">
							<div class="order-right">
								<div class="order-bottom" style="border-bottom: 1px solid #F4F4F4;height: .9rem;">
									<div class="order-price">订单号:{{val.pbOrderId}}</div>
									<a class="order-time" :href="['tel:'+val.usName]" style="font-size: .2rem;color: #096148;">
										联系用户
									</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">清洗最迟时间</div>
									<div class="order-time">{{val.pbOrCleanTimeString}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price">取送员电话</div>
									<a class="order-time" :href="['tel:'+val.usStPhone]">{{val.usStPhone}}</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">订单价格</div>
									<div class="order-time">￥{{val.pbOrCountPrice}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price" style="flex: 1;height: auto;">
										订单内容:
										<bloack v-for='item in val.orderDetaileList'>
											{{item.pbCdName}} x{{item.pbRdNum}}
										</bloack>
									</div>
								</div>
							</div>
						</div>
						<div class="order-box" v-if="myindex==8" v-for="val in mydata" @click="opendetail(val.pbOrderId)">
							<div class="order-right">
								<div class="order-bottom" style="border-bottom: 1px solid #F4F4F4;height: .9rem;">
									<div class="order-price">订单号:{{val.pbOrderId}}</div>
									<a class="order-time" :href="['tel:'+val.usName]" style="font-size: .2rem;color: #096148;">
										联系用户
									</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">清洗最迟时间</div>
									<div class="order-time">{{val.pbOrCleanTimeString}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price">取送员电话</div>
									<a class="order-time" :href="['tel:'+val.usStPhone]">{{val.usStPhone}}</a>
								</div>
								<div class="order-bottom">
									<div class="order-price">订单价格</div>
									<div class="order-time">￥{{val.pbOrCountPrice}}</div>
								</div>
								<div class="order-bottom">
									<div class="order-price" style="flex: 1;height: auto;">
										订单内容:
										<bloack v-for='item in val.orderDetaileList'>
											{{item.pbCdName}} x{{item.pbRdNum}}
										</bloack>
									</div>
								</div>
								<div class="order-bottom" style="border-top: 1px solid #F4F4F4;">
									<div class="order-price"></div>
									<div class="order-time setting">
										<!--<a class="btn01" href="nav.html">调整订单</a>-->
										<a class="btn02" href="javascript:void(0)" @click="orderisok(val.pbOrderId,val.usCommunityPartnerId)">完成订单</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="alert" v-show="alertboo" @click="alertshow">
				<div class="alert-inner">
					<img src="img/yes.png" />
					<div class="text">操作已完成, {{time}}后返回</div>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var myvue = new Vue({
				el: '.wrapper',
				data: {
					myindex: 4,
					alertboo: false,
					time: 3,
					mydata:''
				},
				methods: {
					opendetail:function(id){
						localStorage.setItem('orderId',id)
						this.opennew('orderdetail')
					},
					orderisok:function(id,UsCommunityPartnerId){
						var that = this
//						完成订单
						$.ajax({
							type: "post",
							url: localStorage.getItem('myurl') + "/laundry/updateLaundryOrderByFinally",
							dataType: 'json',
							data: {
								pbOrderId:id,
								updateName:localStorage.getItem('uname'),
								usCommunityPartnerId:UsCommunityPartnerId,
								usStoreId:localStorage.getItem('uid')
							},
							success: function(res) {
								console.log(res)
								if(res.data==1){
									that.pay()
									that.myajax()
								}else{
									alert('操作失败！')
								}
							}
						});
					},
					orderok:function(id,UsUserId){
						var that = this
//						审核订单
						$.ajax({
							type: "post",
							url: localStorage.getItem('myurl') + "/laundry/updateLaundryOrderId",
							dataType: 'json',
							data: {
								pbOrderId:id,
								updateName:localStorage.getItem('uname'),
								UsUserId:UsUserId,
								UsStoreId:localStorage.getItem('uid')
							},
							success: function(res) {
								if(res.data==1){
									that.pay()
									that.myajax()
								}else{
									alert('操作失败！')
								}
							}
						});
					},
					indexchange: function(index) {
						this.myindex = index
						this.myajax()
					},
					opennew: function(target,id,id02,id03,cartdata,usUserId) {
						localStorage.setItem('pbPartnerDeviceCaseId',id)
						localStorage.setItem('usCommunityPartnerId',id02)
						localStorage.setItem('pbOrderId',id03)
						localStorage.setItem('cartdataold',JSON.stringify(cartdata))
						localStorage.setItem('usUserId',usUserId)            
						mui.openWindow({
							url: './' + target + '.html',
							id: target,
							createNew:true
						})
					},
					alertshow: function() {
						this.alertboo = !this.alertboo
					},
					pay: function() {
						var that = this
						that.alertshow()
						var set = setInterval(function() {
							if(that.time == 1) {
								clearInterval(set)
								that.time = 3
								that.alertshow()
							} else {
								that.time--
							}
						}, 1000)
					},
					myajax: function() {
						var that = this
//						待审核
						var pbOrProblemStatus=''
						if(that.myindex=='7'){pbOrProblemStatus='2'}
						$.ajax({
							type: "post",
							url: localStorage.getItem('myurl') + "/laundry/selectLaundryOrder",
							dataType: 'json',
							data: {
								usStoreId:localStorage.getItem('uid'),
								pbOrStatus:that.myindex,
								pbOrProblemStatus:pbOrProblemStatus
							},
							success: function(res) {
								console.log(res)
								that.mydata=res.data
							}
						});
					}
				},
				mounted: function() {
					this.myajax()
				}
			})
		</script>
	</body>

</html>